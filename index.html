<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ´¾å°å¤§é›»è¦– Pro</title>
    <style>
        :root {
            --bg-color: #2c3e50;
            --text-color: #ecf0f1;
            --accent: #f39c12;
            --secondary: #34495e;
            --correct: #27ae60;
            --skip: #c0392b;
            --input-bg: #fff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            touch-action: none;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Common Screen Styles */
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            height: 100%;
            width: 100%;
            transition: background-color 0.3s;
            overflow-y: auto; /* Allow scrolling on home screen */
            -webkit-overflow-scrolling: touch;
        }

        .screen.active {
            display: flex;
        }

        /* --- HOME SCREEN --- */
        #home-screen {
            padding: 20px 0;
        }

        h1 { font-size: 2.5rem; margin: 10px 0; text-shadow: 2px 2px 0 #000; text-align: center; }
        
        .category-section {
            width: 90%;
            max-width: 600px;
            margin-bottom: 20px;
        }

        .category-title {
            font-size: 1.2rem;
            color: var(--accent);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        button {
            background: var(--text-color);
            color: var(--bg-color);
            border: none;
            padding: 12px;
            font-size: 1rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
            transition: transform 0.1s;
            width: 100%;
        }
        button:active { transform: scale(0.96); }
        .btn-start-custom { background: var(--accent); color: white; margin-top: 10px; }

        /* Custom Input Area */
        .custom-area {
            background: var(--secondary);
            padding: 15px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            margin-bottom: 40px; /* Space for scrolling */
        }
        textarea {
            width: 100%;
            height: 80px;
            border-radius: 5px;
            border: none;
            padding: 10px;
            font-size: 1rem;
            box-sizing: border-box;
            resize: none;
            margin-top: 5px;
            font-family: inherit;
        }

        /* --- GAME SCREEN --- */
        #game-screen {
            justify-content: center;
            overflow: hidden; /* No scroll in game */
            text-align: center;
        }
        
        #word-display {
            font-size: 4.5rem;
            font-weight: 800;
            line-height: 1.2;
            padding: 0 20px;
            word-break: keep-all;
        }
        .info-bar {
            position: absolute;
            top: 20px;
            display: flex;
            justify-content: space-between;
            width: 90%;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 10;
        }
        .instructions {
            position: absolute;
            bottom: 30px;
            font-size: 1rem;
            opacity: 0.7;
        }

        /* --- RESULT SCREEN --- */
        #result-screen {
            justify-content: center;
            text-align: center;
        }
        .stat-box {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            width: 80%;
            max-width: 400px;
        }
        .stat-num { font-size: 3rem; color: var(--accent); }

        /* Background States */
        .bg-correct { background-color: var(--correct) !important; }
        .bg-skip { background-color: var(--skip) !important; }
    </style>
</head>
<body>

    <div id="home-screen" class="screen active">
        <h1>ğŸ“º æ´¾å°å¤§é›»è¦– Pro</h1>
        <p style="margin-top:0; color:#aaa; font-size:0.9rem;">(æ”¾åœ¨é¡é ­ï¼Œè¢å¹•å‘å¤–)</p>
        
        <div id="categories-container">
            </div>

        <div class="custom-area">
            <div style="font-weight:bold; color:var(--accent);">âœï¸ è‡ªè¨‚é¡Œç›® (ç”¨é€—è™Ÿæˆ–æ›è¡Œåˆ†éš”)</div>
            <textarea id="custom-input" placeholder="ä¾‹å¦‚ï¼š
åŒäº‹A
è€ç´°
èŒ¶æ°´é–“
..."></textarea>
            <button class="btn-start-custom" onclick="startCustomGame()">é–‹å§‹è‡ªè¨‚éŠæˆ²</button>
        </div>
        
        <p style="font-size:0.8rem; color:#666; padding-bottom: 20px;">âš ï¸ iOS ç”¨æˆ¶éœ€å…è¨±å‹•ä½œæ¬Šé™</p>
    </div>

    <div id="game-screen" class="screen">
        <div class="info-bar">
            <span id="timer">60s</span>
            <span id="score">0 åˆ†</span>
        </div>
        <div id="word-display">æº–å‚™å¥½æœª?</div>
        <div class="instructions">
            é»é ­ (è¢å¹•å‘åœ°) = ç­”å•± âœ…<br>
            æŠ¬é ­ (è¢å¹•å‘å¤©) = Skip âŒ
        </div>
    </div>

    <div id="result-screen" class="screen">
        <h1>æ™‚é–“åˆ°ï¼</h1>
        <div class="stat-box">
            <div>æœ€çµ‚å¾—åˆ†</div>
            <div class="stat-num" id="final-score">0</div>
        </div>
        <button onclick="goHome()" style="width: auto; padding: 15px 40px;">è¿”å›ä¸»é </button>
    </div>

    <script>
        // --- é¡Œåº«è³‡æ–™ (Data with Categories) ---
        const categories = {
            "ğŸ”¥ æµè¡Œç†±è©± (2024/25)": {
                "å¹´åº¦å»£æ±æ­Œ": ["é»‘ç»ç’ƒ", "ç·Šæ€¥è¯çµ¡äºº", "ç­†è§¸ç”·å­©æ†‚é¬±ä¹‹æ­»", "è‡³å°‘åšä¸€ä»¶é›¢è­œçš„äº‹", "æˆ€æ„›è…¦ä¹‹æ­»", "å›æ†¶åŠåˆ†é˜", "åªè¦ä½ ä¸å°·å°¬", "é’æ˜¥å‘Šåˆ¥å¼", "å°å¿ƒç¢°é ­", "éš±å½¢éŠæ¨‚å ´", "Eå…ˆç”Ÿé€£ç’°ä¸å¹¸äº‹ä»¶"],
                "å¤§ç†± K-Pop": ["APT.", "Supernova", "Magnetic", "Rockstar", "How Sweet", "Queencard", "Fate", "Spot!", "Klaxon", "Seven", "Flower", "Ditto"],
                "ç¶²çµ¡æ½®èª": ["ä¸–ä¸€", "E Boy", "I äºº", "ç ´é˜²", "æœƒè€ƒ4åˆ†", "Emo", "æ²‰èˆ¹", "0å°Š", "MM7", "Siu4", "Firm", "è‡ªè‚¥"]
            },
            "ğŸ‡­ğŸ‡° é¦™æ¸¯åœ°é“": {
                "ç¶“å…¸æ¸¯ç”¢ç‰‡": ["ç„¡é–“é“", "é£Ÿç¥", "å°‘æ—è¶³çƒ", "å®¶æœ‰å›äº‹", "ä¹å“èŠéº»å®˜", "å¯’æˆ°", "å¤æƒ‘ä»”", "è³­ç¥", "æ­²æœˆç¥å·", "åœ‹ç”¢å‡Œå‡Œæ¼†", "é˜¿é£›æ­£å‚³", "æ˜¥å¨‡ä¸å¿—æ˜"],
                "åœ°é“ç¾é£Ÿ": ["é­šè›‹", "ç‡’è³£", "é›è›‹ä»”", "è è˜¿æ²¹", "æ ¼ä»”é¤…", "çµ²è¥ªå¥¶èŒ¶", "ä¹¾ç‚’ç‰›æ²³", "è¥¿å¤šå£«", "å‰ç‡’é£¯", "è›‹æ’»", "ç¢—ä»”ç¿…", "è‡­è±†è…", "æ¥Šæç”˜éœ²"],
                "é¦™æ¸¯è—äºº": ["å§œæ¿¤", "å¼µæ•¬è»’", "Anson Lo", "å¤å¤©æ¨‚", "é»ƒå­è¯", "æ—å®¶è¬™", "é„§ç´«æ£‹", "é™³å¥•è¿…", "å®¹ç¥–å…’", "åŠ‰å¾·è¯", "å‘¨æ½¤ç™¼", "æ¢æœå‰"]
            },
            "ğŸ¤¸ è¼•é¬†å¥½ç©": {
                "å‹•ä½œé¡Œ (è¦åšå‹•ä½œ)": ["æ¸¸æ°´", "æ‰“éº»é›€", "åŒ–å¦", "æ´—é ­", "ä¾¿ç§˜", "æ±‚å©š", "æ‰“é‚Šçˆ", "æ¸è»Š", "è·³èŠ­è•¾èˆ", "èˆ‰é‡", "è‡ªæ‹", "é£²é†‰é…’", "åšGym"],
                "å‹•ç‰©ä¸–ç•Œ": ["é•·é ¸é¹¿", "å¤§ç¬¨è±¡", "ç…å­", "ç†Šè²“", "ä¼éµ", "æ¨¹æ‡¶", "è¢‹é¼ ", "æµ·è±š", "è®Šè‰²é¾", "çŒ©çŒ©", "å“¥æ–¯æ‹‰", "æ°´æ€ª"]
            }
        };

        // --- éŠæˆ²ç‹€æ…‹ ---
        let currentWords = [];
        let score = 0;
        let timeLeft = 60;
        let timerInterval;
        let isGameActive = false;
        let canTilt = true; 

        // --- DOM Elements ---
        const homeScreen = document.getElementById('home-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const wordDisplay = document.getElementById('word-display');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const categoriesContainer = document.getElementById('categories-container');
        const customInput = document.getElementById('custom-input');

        // --- åˆå§‹åŒ–é¸å–® (Render Categories) ---
        function initMenu() {
            categoriesContainer.innerHTML = '';

            for (const [catName, themes] of Object.entries(categories)) {
                // Create Category Section
                const section = document.createElement('div');
                section.className = 'category-section';

                const title = document.createElement('div');
                title.className = 'category-title';
                title.innerText = catName;
                section.appendChild(title);

                const grid = document.createElement('div');
                grid.className = 'theme-grid';

                // Create Theme Buttons
                for (const [themeName, words] of Object.entries(themes)) {
                    const btn = document.createElement('button');
                    btn.innerText = themeName;
                    btn.onclick = () => prepareGame(words);
                    grid.appendChild(btn);
                }

                section.appendChild(grid);
                categoriesContainer.appendChild(section);
            }
        }

        // --- è™•ç†è‡ªè¨‚éŠæˆ² ---
        function startCustomGame() {
            const rawText = customInput.value;
            // Split by newline or comma, trim whitespace, filter empty strings
            const words = rawText.split(/[\n,ï¼Œ]+/).map(w => w.trim()).filter(w => w.length > 0);

            if (words.length < 2) {
                alert("è«‹è‡³å°‘è¼¸å…¥ 2 å€‹è©èªï¼");
                return;
            }
            prepareGame(words);
        }

        // --- éŠæˆ²æº–å‚™èˆ‡é–‹å§‹ ---
        async function prepareGame(wordsList) {
            // Request Permissions (iOS 13+)
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    if (permissionState !== 'granted') {
                        alert("éœ€è¦å‹•ä½œæ¬Šé™æ‰èƒ½ç©é«”æ„Ÿæ¨¡å¼ï¼");
                        return;
                    }
                } catch (e) {
                    console.error(e);
                }
            }

            // Shuffle words
            currentWords = [...wordsList].sort(() => 0.5 - Math.random());
            
            startGameLogic();
        }

        function startGameLogic() {
            score = 0;
            timeLeft = 60;
            scoreDisplay.innerText = score + " åˆ†";
            timerDisplay.innerText = timeLeft + "s";
            isGameActive = true;
            canTilt = true;

            homeScreen.classList.remove('active');
            resultScreen.classList.remove('active');
            gameScreen.classList.add('active');
            gameScreen.className = "screen active"; 

            nextWord();
            
            // Timer
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = timeLeft + "s";
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);

            window.addEventListener('deviceorientation', handleOrientation);
        }

        function nextWord() {
            if (currentWords.length === 0) {
                wordDisplay.innerText = "é¡Œç›®å®Œæ™’ï¼";
                setTimeout(endGame, 1500);
                return;
            }
            const word = currentWords.pop();
            wordDisplay.innerText = word;
            gameScreen.className = "screen active"; // Reset colors
            canTilt = true;
        }

        function handleAnswer(type) {
            if (!isGameActive || !canTilt) return;
            canTilt = false;

            if (type === 'correct') {
                score++;
                scoreDisplay.innerText = score + " åˆ†";
                gameScreen.classList.add('bg-correct');
                wordDisplay.innerText = "âœ… ç­”å•±ï¼";
            } else {
                gameScreen.classList.add('bg-skip');
                wordDisplay.innerText = "âŒ Skip";
            }
        }

        // --- é«”æ„Ÿåµæ¸¬ ---
        function handleOrientation(event) {
            if (!isGameActive) return;
            const beta = event.beta; 

            // Debounce/Reset zone (Upright)
            if (!canTilt && beta > 60 && beta < 120) {
                canTilt = true;
                nextWord(); 
                return;
            }

            if (canTilt) {
                if (beta > 135) {
                    handleAnswer('correct'); // Face down
                } else if (beta < 35) {
                    handleAnswer('skip'); // Face up
                }
            }
        }

        // Fallback Touch Controls
        gameScreen.addEventListener('click', (e) => {
            if (e.clientY < window.innerHeight / 2) {
                if(canTilt) handleAnswer('skip');
            } else {
                if(canTilt) handleAnswer('correct');
            }
            setTimeout(() => {
                if(!canTilt) { canTilt = true; nextWord(); }
            }, 800);
        });

        function endGame() {
            isGameActive = false;
            clearInterval(timerInterval);
            window.removeEventListener('deviceorientation', handleOrientation);
            document.getElementById('final-score').innerText = score;
            gameScreen.classList.remove('active');
            resultScreen.classList.add('active');
        }

        function goHome() {
            resultScreen.classList.remove('active');
            homeScreen.classList.add('active');
        }

        // Run
        initMenu();

    </script>
</body>
</html>
