<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ´¾å°å¤§é›»è¦– Ultimate</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-color: #2c3e50;
            --text-color: #ecf0f1;
            --accent: #f39c12;
            --secondary: #34495e;
            --correct: #27ae60;
            --skip: #c0392b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            touch-action: none;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            height: 100%;
            width: 100%;
            transition: background-color 0.2s;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .screen.active { display: flex; }

        /* --- HOME SCREEN --- */
        #home-screen { padding: 20px 0; }
        h1 { font-size: 2.2rem; margin: 10px 0; text-shadow: 2px 2px 0 #000; }
        
        .settings-box {
            background: var(--secondary);
            padding: 15px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .time-control {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }
        
        input[type="range"] {
            flex-grow: 1;
            accent-color: var(--accent);
            height: 20px;
        }

        .category-section { width: 90%; max-width: 600px; margin-bottom: 15px; }
        .category-title {
            font-size: 1.3rem;
            color: var(--accent);
            border-bottom: 2px solid var(--secondary);
            margin-bottom: 10px;
            font-weight: bold;
        }
        .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        button {
            background: var(--text-color);
            color: var(--bg-color);
            border: none;
            padding: 15px;
            font-size: 1.1rem;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        button:active { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); }
        .btn-start-custom { background: var(--accent); color: white; width: 100%; margin-top: 10px; }

        textarea {
            width: 100%; height: 80px; border-radius: 5px; padding: 10px;
            font-size: 1rem; box-sizing: border-box; resize: none; margin-top: 5px;
        }

        /* --- GAME SCREEN --- */
        #game-screen {
            justify-content: center;
            overflow: hidden;
            text-align: center;
            position: relative;
        }
        
        /* SUPER BIG TEXT */
        #word-display {
            font-size: 18vw; 
            font-weight: 900;
            line-height: 1.1;
            padding: 0 10px;
            word-break: keep-all;
            text-align: center;
        }
        
        .info-bar {
            position: absolute;
            top: 20px;
            display: flex;
            justify-content: space-between;
            width: 90%;
            font-size: 2rem;
            font-weight: bold;
            z-index: 10;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .instructions {
            position: absolute;
            bottom: 30px;
            font-size: 1.2rem;
            opacity: 0.8;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 20px;
        }

        /* --- RESULT SCREEN --- */
        #result-screen { padding: 20px 0; }
        .rank-title { font-size: 2.5rem; color: var(--accent); font-weight: 900; margin: 10px 0; animation: popIn 0.5s; }
        
        .result-list-container {
            width: 90%;
            max-width: 500px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 10px;
            margin: 15px 0;
            max-height: 40vh;
            overflow-y: auto;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 1.2rem;
        }
        .result-item:last-child { border-bottom: none; }
        .res-word { font-weight: bold; }
        .res-icon { font-weight: bold; }
        .res-correct { color: var(--correct); }
        .res-skip { color: var(--skip); }

        .big-score { font-size: 4rem; font-weight: 900; margin: 0; line-height: 1; }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .bg-correct { background-color: var(--correct) !important; }
        .bg-skip { background-color: var(--skip) !important; }
    </style>
</head>
<body>

    <div id="home-screen" class="screen active">
        <h1>ğŸ“º æ´¾å°å¤§é›»è¦– <span style="font-size:1rem; vertical-align:middle; background:var(--accent); padding:2px 5px; border-radius:4px;">MAX</span></h1>
        
        <div class="settings-box">
            <div class="time-control">
                <span>â±ï¸ æ™‚é™: <span id="time-val" style="color:var(--accent); font-weight:bold; width: 40px; display:inline-block;">60</span>ç§’</span>
                <input type="range" id="time-slider" min="30" max="180" step="10" value="60" oninput="updateTimeVal(this.value)">
            </div>
        </div>

        <div id="categories-container"></div>

        <div class="category-section">
            <div class="category-title">âœï¸ è‡ªè¨‚é¡Œç›®</div>
            <textarea id="custom-input" placeholder="ä¾‹å­ï¼š
é™³å¤§æ–‡
èŒ¶æ°´é–“
OT
(æ›è¡Œåˆ†éš”)"></textarea>
            <button class="btn-start-custom" onclick="startCustomGame()">é–‹å§‹è‡ªè¨‚éŠæˆ²</button>
        </div>
        <p style="color:#777; font-size:0.8rem; margin-bottom:30px;">âš ï¸ iOS è«‹å…è¨±å‹•ä½œæ¬Šé™</p>
    </div>

    <div id="game-screen" class="screen">
        <div class="info-bar">
            <span id="timer">60</span>
            <span id="score">0</span>
        </div>
        <div id="word-display">Ready?</div>
        <div class="instructions">
            é»é ­ = âœ… | æŠ¬é ­ = âŒ
        </div>
    </div>

    <div id="result-screen" class="screen">
        <div style="font-size:1.2rem; margin-top:20px;">æ™‚é–“åˆ°ï¼æœ€çµ‚å¾—åˆ†</div>
        <div class="big-score" id="final-score">0</div>
        <div class="rank-title" id="rank-title"></div>
        
        <div class="result-list-container" id="result-list">
            </div>

        <button onclick="goHome()" style="width: 80%; max-width:300px; background:white; color:#333;">å†ä¾†ä¸€å±€</button>
    </div>

    <script>
        // --- DATA ---
        const categories = {
            "ğŸ§º Picnic Day Special": {
                "picnic day": [
                    "factorial", "recessive allele", "titration", "è²è²æ…¢", "åå››äº”è¦åŠƒ", 
                    "è›¾å…’é›ªæŸ³é»ƒé‡‘ç¸·", "èŠ±é–“ä¸€å£ºé…’", "è“®å‹•ä¸‹æ¼èˆŸ", "æ—é»›ç‰", "å”åƒ§", 
                    "ç²Ÿç±³", "çç å¥¶èŒ¶", "åƒåœ¾æ¡¶", "seventeen", "ç”¨èƒŒè„Šå”±æƒ…æ­Œ", 
                    "å¼µåœ°åº«", "é»‘ç»ç’ƒ", "ç”¨æ‚²å‚·çµäº†å¸³", "è«¸è‘›äº®", "å¾Œä¸»", 
                    "å…ˆå¸", "æç™½", "ç‡ˆç«é—ŒçŠè™•", "cristae", "LSM1", 
                    "LCC", "NYK", "B sir", "chiikawa", "ç·£æƒ…å¯«æ™¯", 
                    "å€Ÿä»£", "è¾›æ£„ç–¾", "æ±ªæ˜èƒ", "zootopia", "å¤§å¯¶å†°å®¤", 
                    "Cedric", "éº¥ç•¶å‹", "KFC", "æŠ«æ˜Ÿæˆ´æœˆ", "è…ä¹³é€šèœ", 
                    "ç«è…¿é€šç²‰", "åŒ—æ¥µç†Š", "picnic"
                ]
            },
            "ğŸµ K-Pop Melon Top (æœ€æ–°)": {
                "Melonéœ¸æ¦œ": ["APT.", "Whiplash", "Happy", "Power", "Mantra", "Supernova", "Magnetic", "UP", "Love wins all", "Welcome to the Show"],
                "å¤§å‹¢åœ˜é«”": ["aespa", "NewJeans", "IVE", "QWER", "DAY6", "BLACKPINK", "G-Dragon", "SEVENTEEN", "ILLIT", "LE SSERAFIM"]
            },
            "ğŸ‡­ğŸ‡° é¦™æ¸¯æµè¡Œ (2024/25)": {
                "å¹´åº¦é‡‘æ›²": ["é»‘ç»ç’ƒ", "ç·Šæ€¥è¯çµ¡äºº", "ç­†è§¸ç”·å­©æ†‚é¬±ä¹‹æ­»", "è‡³å°‘åšä¸€ä»¶é›¢è­œçš„äº‹", "æˆ€æ„›è…¦ä¹‹æ­»", "å›æ†¶åŠåˆ†é˜", "é’æ˜¥å‘Šåˆ¥å¼", "å°å¿ƒç¢°é ­", "éš±å½¢éŠæ¨‚å ´"],
                "æ­Œæ‰‹/åäºº": ["å§œæ¿¤", "å¼µæ•¬è»’", "Anson Lo", "æ—å®¶è¬™", "Jeffrey", "Serrini", "MCå¼µå¤©è³¦", "å°¹å…‰", "é™³è•¾", "COLLAR"]
            },
            "ğŸ˜‚ æ´¾å°å¿…ç©": {
                "å‹•ä½œé¡Œ": ["æ¸¸æ°´", "ä¾¿ç§˜", "åŒ–å¦", "æ´—é ­", "æ±‚å©š", "æ‰“éº»é›€", "åšGym", "å¦‚å»ä¸­", "é£²é†‰é…’", "è¸©å–®è»Š", "æ’©é¼»å±", "æ®ºæ›±ç”´"],
                "ç¶“å…¸æ¸¯ç”¢ç‰‡": ["ç„¡é–“é“", "é£Ÿç¥", "å°‘æ—è¶³çƒ", "å®¶æœ‰å›äº‹", "å¯’æˆ°", "å¤æƒ‘ä»”", "è³­ç¥", "ä¹å“èŠéº»å®˜", "åœ‹ç”¢å‡Œå‡Œæ¼†", "æ˜¥å¨‡ä¸å¿—æ˜"]
            }
        };

        // --- STATE ---
        let currentWords = [];
        let gameResults = []; 
        let score = 0;
        let timeLeft = 60;
        let initialTime = 60;
        let timerInterval;
        let isGameActive = false;
        let canTilt = true; 

        // --- ELEMENTS ---
        const homeScreen = document.getElementById('home-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const wordDisplay = document.getElementById('word-display');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const resultList = document.getElementById('result-list');
        const rankTitle = document.getElementById('rank-title');
        
        function updateTimeVal(val) {
            document.getElementById('time-val').innerText = val;
            initialTime = parseInt(val);
        }

        function initMenu() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';
            for (const [catName, themes] of Object.entries(categories)) {
                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `<div class="category-title">${catName}</div>`;
                const grid = document.createElement('div');
                grid.className = 'theme-grid';
                for (const [themeName, words] of Object.entries(themes)) {
                    const btn = document.createElement('button');
                    btn.innerText = themeName;
                    btn.onclick = () => prepareGame(words);
                    grid.appendChild(btn);
                }
                section.appendChild(grid);
                container.appendChild(section);
            }
        }

        function startCustomGame() {
            const raw = document.getElementById('custom-input').value;
            const words = raw.split(/[\n,ï¼Œ]+/).map(w => w.trim()).filter(w => w.length > 0);
            if (words.length < 2) { alert("è«‹è‡³å°‘è¼¸å…¥ 2 å€‹è©èªï¼"); return; }
            prepareGame(words);
        }

        async function prepareGame(wordsList) {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    if (permission !== 'granted') return alert("éœ€é–‹å•Ÿå‹•ä½œæ¬Šé™ï¼");
                } catch (e) {}
            }
            currentWords = [...wordsList].sort(() => 0.5 - Math.random());
            startGame();
        }

        function startGame() {
            score = 0;
            timeLeft = initialTime;
            gameResults = []; // Reset history
            
            scoreDisplay.innerText = score;
            timerDisplay.innerText = timeLeft;
            isGameActive = true;
            canTilt = true;

            homeScreen.classList.remove('active');
            resultScreen.classList.remove('active');
            gameScreen.classList.add('active');
            gameScreen.className = "screen active";

            nextWord();

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);

            window.addEventListener('deviceorientation', handleOrientation);
        }

        function nextWord() {
            if (currentWords.length === 0) {
                endGame();
                return;
            }
            const word = currentWords.pop();
            // Adjust font size based on length roughly
            if(word.length > 8) wordDisplay.style.fontSize = "12vw";
            else if(word.length > 4) wordDisplay.style.fontSize = "16vw";
            else wordDisplay.style.fontSize = "22vw";
            
            wordDisplay.innerText = word;
            wordDisplay.dataset.current = word; 
            
            gameScreen.className = "screen active";
            canTilt = true;
        }

        function handleAnswer(type) {
            if (!isGameActive || !canTilt) return;
            canTilt = false;
            
            const currentWord = wordDisplay.dataset.current;

            if (type === 'correct') {
                score++;
                scoreDisplay.innerText = score;
                gameScreen.classList.add('bg-correct');
                wordDisplay.innerText = "â­•";
                gameResults.push({ word: currentWord, status: 'correct' });
            } else {
                gameScreen.classList.add('bg-skip');
                wordDisplay.innerText = "âŒ";
                gameResults.push({ word: currentWord, status: 'skip' });
            }
        }

        function handleOrientation(e) {
            if (!isGameActive) return;
            const beta = e.beta;
            if (!canTilt && beta > 60 && beta < 120) {
                canTilt = true;
                nextWord();
                return;
            }
            if (canTilt) {
                if (beta > 135) handleAnswer('correct');
                else if (beta < 35) handleAnswer('skip');
            }
        }

        // Touch Fallback
        gameScreen.addEventListener('click', (e) => {
            if (!isGameActive) return;
            if (e.clientY < window.innerHeight / 2) {
                if(canTilt) handleAnswer('skip');
            } else {
                if(canTilt) handleAnswer('correct');
            }
            setTimeout(() => { if(!canTilt) { canTilt=true; nextWord(); } }, 600);
        });

        function endGame() {
            isGameActive = false;
            clearInterval(timerInterval);
            window.removeEventListener('deviceorientation', handleOrientation);

            document.getElementById('final-score').innerText = score;
            resultList.innerHTML = '';
            
            gameResults.forEach(item => {
                const div = document.createElement('div');
                div.className = 'result-item';
                div.innerHTML = `
                    <span class="res-word">${item.word}</span>
                    <span class="res-icon ${item.status === 'correct' ? 'res-correct' : 'res-skip'}">
                        ${item.status === 'correct' ? 'âœ…' : 'âŒ'}
                    </span>
                `;
                resultList.appendChild(div);
            });

            // Emotional Value
            let title = "";
            if (score >= 15) title = "ğŸ‘‘ ç¥ç´šç©å®¶";
            else if (score >= 10) title = "ğŸ”¥ é«˜æ‰‹éæ‹›";
            else if (score >= 5) title = "ğŸ˜ æ™®é€šäººé¡";
            else title = "ğŸ¢ è±¬éšŠå‹";
            
            rankTitle.innerText = title;

            gameScreen.classList.remove('active');
            resultScreen.classList.add('active');

            if (score >= 5) {
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
        }

        function goHome() {
            resultScreen.classList.remove('active');
            homeScreen.classList.add('active');
        }

        initMenu();
    </script>
</body>
</html>
